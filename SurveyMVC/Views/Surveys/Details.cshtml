@model SurveyMVC.Models.Survey

@{
    ViewBag.Title = "Survey Details";
}

<style>
    .survey-details {
        margin-top: 40px;
    }

    .survey-title {
        font-size: 26px;
        font-weight: bold;
        margin-bottom: 10px;
        color: #2c3e50;
    }

    .survey-meta {
        color: #888;
        margin-bottom: 20px;
    }

    .questions-list {
        margin-top: 30px;
        padding-left: 0;
        list-style: none;
    }

    .question-item {
        background: #f9f9f9;
        border-left: 5px solid #007bff;
        padding: 15px 20px;
        margin-bottom: 15px;
        border-radius: 8px;
        box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }

    .question-number {
        font-weight: bold;
        color: #007bff;
        margin-right: 10px;
    }

    .no-questions {
        color: #999;
        font-style: italic;
        margin-top: 10px;
    }
</style>

<div class="survey-details">
    <h2 class="survey-title">@Model.Title Survey</h2>
    <hr />

    @if (Model.Questions != null && Model.Questions.Any())
    {
        if (Model.Responses.Count == 0)
        {
            <h4>No submited responses</h4>
        }
        else
        {
            <h4>Number of Response(s): @Model.Responses.Count</h4>
        }
    }

    <h3 style="margin-top: 50px">Questions</h3>

    @if (Model.Questions != null && Model.Questions.Any())
    {
        <ul class="questions-list">
            @for (int i = 0; i < Model.Questions.Count; i++)
            {
                <li class="question-item">
                    <span class="question-number">Q@(i + 1):</span>
                    @Model.Questions[i].QuestionDetails
                    @if (Model.Responses.Count > 0)
                    { 
                        <input type="button" class="btn btn-primary" value="Show Response(s)" id="question@(i)" onclick="toggleResponses(@(i))" />
                        <div class="d-none" id="responses@(i)">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Responder</th>
                                        <th>Answer</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var answer in Model.Questions[i].Answers)
                                    {
                                        <tr>
                                            <td>@answer.Response.Employee.UserName</td>
                                            <td>@answer.AnswerDetails</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                </li>
            }
        </ul>
    }
    else
    {
        <div class="no-questions">
            This survey has no questions yet.
        </div>
    }

    <hr />

    <p>
        @if (Model.Responses.Count == 0)
        {
            @Html.ActionLink("Edit", "Edit", new { id = Model.Id }, new { @class = "btn btn-warning" })
        }
        @Html.ActionLink("Back to List", "Index", null, new { @class = "btn btn-secondary" })
    </p>
</div>

<script>
    function toggleResponses(i) {
        var btn = document.getElementById("question" + i);
        var div = document.getElementById("responses" + i);
        if (div.classList.contains("d-none")) {
            btn.classList.remove("btn-primary");
            btn.classList.add("btn-secondary");
            btn.value = "Hide Response(s)";
            div.classList.remove("d-none");
        }
        else {
            btn.classList.add("btn-primary");
            btn.classList.remove("btn-secondary");
            btn.value = "Show Response(s)";
            div.classList.add("d-none");
        }
    }
</script>